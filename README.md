# CYSEC Coach Maven Plugin

This Maven plugin can be used to integrate coach resources (e.g. libraries and media files) as base64-encoded content and generate a flattened XML file.
Additionally, there are tools to support the development and build process of multilingual coaches.

## Goals

### `flatify` goal
Used to integrate coach resources (e.g. libraries and media files) as base64-encoded content and generate a flattened XML file.

_Binds to the `prepare-package` phase by default._

| Parameter            | Required  | Description  | Default value  |
|----------------------|-----------|--------------|----------------|
| `inputDirectory`     | no        | Path to the folder containing the coach and its resources | `${project.build.directory}/flatify-input` |
| `outputFile`         | no        | Destination of the flattened XML file | `${project.build.directory}/${project.artifactId}.xml` |
| `languageConfigFile` | no        | Language configuration file (XML) for building multilingual coaches | _none_ |

It is suggested to use a dedicated input directory (see the default above) where all the resources are placed before running the plugin.
This directory can be configured as an output directory for other build stages, e.g. `maven-assembly-plugin` when building a JAR file.
Other resources can be copied there easily with the `copy-resources` goal of the `maven-resources-plugin`.

**Usage in the POM:**
```xml
<build>
    <plugins>
        <!-- ... -->
        <plugin>
            <groupId>eu.smesec.platform</groupId>
            <artifactId>coach-maven-plugin</artifactId>
            <version>${FLATIFIER_VERSION}</version>
            <executions>
                <execution>
                    <id>flatify-coach</id>
                    <goals>
                        <goal>flatify</goal>
                    </goals>
                </execution>
            </executions>
            <configuration>
                <inputDirectory>path/to/input/coach-xy/</inputDirectory>
                <outputFile>path/to/output/coach-xy-flat.xml</outputFile>
                <!--<languageConfigFile>path/to/config/config.xml</languageConfigFile>-->
            </configuration>
        </plugin>
    </plugins>
</build>
```

#### Multilingual use of the `flatify` goal
If a `languageConfigFile` is provided, the `inputDirectory` should point to the directory with the required folder structure for multilingual build (see below).
The `outputFile` is used to define the output directory and base name of the coaches.
The language codes will be appended to the base name followed by the extension (`coach.xml` -> `coach-de.xml`).

The flatifier needs to contain a directory for each language which has `flatify="true"` configured in the language configuration file.
By default, the files of the respective language are used by the flatifier. If no language-specific file exists (e.g. `image.jpg`),
the file of the `original` folder structure is being used.

The required folder structure looks like this:
```text
inputDirectory/
├── original/
│   ├── coach.xml
│   ├── library.jar
│   ├── somefile.txt
│   └── assets/
│       ├── image.jpg
│       └── diagram.png
├── de/
│   ├── coach.xml
│   └── assets/
│       └── diagram.png
└── fr/
    ├── coach.xml
    └── assets/
        └── diagram.png
```

### `extract-translations` goal
Used to extract translatable content to a source XLIFF file that can be used as base for the translations.

_Binds to the `generate-sources` phase by default._

| Parameter   | Required  | Description  | Default value  |
|-------------|-----------|--------------|----------------|
| `coachXml`  | yes       | The original coach file (e.g. `coach.xml`) | _none_ |
| `outputXlf` | yes       | Destination of the translation source file (e.g. `source.xlf`) | _none_ |

When configured in the POM the source XLIFF file can be generated by simply by executing `mvn generate-sources`.

**Usage in the POM:**
```xml
<build>
    <plugins>
        <!-- ... -->
        <plugin>
            <groupId>eu.smesec.platform</groupId>
            <artifactId>coach-maven-plugin</artifactId>
            <version>${FLATIFIER_VERSION}</version>
            <executions>
                <execution>
                    <id>extract-source-xliff</id>
                    <goals>
                        <goal>extract-translation</goal>
                    </goals>
                </execution>
            </executions>
            <configuration>
                <coachXml>path/to/input/coach.xml</coachXml>
                <outputXlf>path/to/output/source.xlf</outputXlf>
            </configuration>
        </plugin>
    </plugins>
</build>
```

### `merge-translations` goal
Used to merge provided translations into the original coach. In this process,
the original strings are replaced with the translated ones defined in the respective XLIFF-file.

_Binds to the `process-resources` phase by default._

| Parameter                  | Required  | Description  | Default value  |
|----------------------------|-----------|--------------|----------------|
| `coachXml`                 | yes       | The original coach file (e.g. `coach.xml`) | _none_ |
| `xlfBaseDir`               | yes       | Directory containing the translations (XLIFF-files) | _none_ |
| `outputBaseDir`            | yes       | Base directory for the translated coaches (sub-folders will be created) | _none_ |
| `languageConfigFile`       | yes       | Language configuration file (XML) for building multilingual coaches | _none_ |
| `failOnMissingTranslation` | no        | Flag to make the run fail if there are missing translations | `false` |

The `xlfBaseDir` needs to contain an XLIFF-file for each language which has `merge="true"` configured.
```text
xlfBaseDir/
├── de.xlf
└── fr.xlf
```

The `outputBaseDir` of has the following structure after a successful run:
```text
outputBaseDir/
├── de/
│   └── coach.xml
└── fr/
    └── coach.xml
```

**Usage in the POM:**
```xml
<build>
    <plugins>
        <!-- ... -->
        <plugin>
            <groupId>eu.smesec.platform</groupId>
            <artifactId>coach-maven-plugin</artifactId>
            <version>${FLATIFIER_VERSION}</version>
            <executions>
                <execution>
                    <id>merge-xliff</id>
                    <goals>
                        <goal>merge-translation</goal>
                    </goals>
                </execution>
            </executions>
            <configuration>
                <coachXml>path/to/input/coach.xml</coachXml>
                <xlfBaseDir>path/to/translations</xlfBaseDir>
                <outputBaseDir>path/to/output</outputBaseDir>
                <languageConfigFile>path/to/config/config.xml</languageConfigFile>
                <!--<failOnMissingTranslation>true</failOnMissingTranslation>-->
            </configuration>
        </plugin>
    </plugins>
</build>
```

### Language configuration file

This file defines whether a coach of the respective language should be **merged** and/or **flatified**.

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<languages>
    <language merge="true" flatify="true">de</language>
    <language merge="false" flatify="false">fr</language>
</languages>
```
